// 城市重要性排序配置
// 用于机场搜索结果的智能排序

export interface CityPriority {
  country: string;
  capital: string;
  majorCities: string[];
  tier1Cities: string[]; // 一线城市
  tier2Cities: string[]; // 二线城市
}

// 主要国家的城市重要性配置
export const cityPriorityConfig: CityPriority[] = [
  {
    country: "中国",
    capital: "北京",
    majorCities: ["上海", "深圳", "广州"],
    tier1Cities: ["杭州", "成都", "重庆", "西安", "南京", "武汉", "天津", "青岛", "大连", "厦门"],
    tier2Cities: ["昆明", "长沙", "郑州", "济南", "福州", "合肥", "南昌", "太原", "石家庄", "哈尔滨", "长春", "沈阳", "乌鲁木齐", "兰州", "银川", "西宁", "拉萨", "呼和浩特", "南宁", "海口", "贵阳"]
  },
  {
    country: "美国",
    capital: "华盛顿",
    majorCities: ["纽约", "洛杉矶", "芝加哥"],
    tier1Cities: ["旧金山", "西雅图", "波士顿", "迈阿密", "拉斯维加斯", "丹佛", "亚特兰大", "达拉斯", "休斯顿", "费城"],
    tier2Cities: ["凤凰城", "圣地亚哥", "坦帕", "奥兰多", "底特律", "明尼阿波利斯", "克利夫兰", "匹兹堡", "辛辛那提", "印第安纳波利斯"]
  },
  {
    country: "日本",
    capital: "东京",
    majorCities: ["大阪", "名古屋"],
    tier1Cities: ["京都", "神户", "横滨", "福冈", "札幌", "仙台"],
    tier2Cities: ["广岛", "新潟", "静冈", "熊本", "鹿儿岛", "那霸", "旭川", "函馆"]
  },
  {
    country: "韩国",
    capital: "首尔",
    majorCities: ["釜山"],
    tier1Cities: ["仁川", "大邱", "大田", "光州"],
    tier2Cities: ["蔚山", "济州", "清州", "全州", "春川", "群山"]
  },
  {
    country: "英国",
    capital: "伦敦",
    majorCities: ["曼彻斯特", "伯明翰"],
    tier1Cities: ["爱丁堡", "格拉斯哥", "利物浦", "利兹", "布里斯托", "纽卡斯尔"],
    tier2Cities: ["谢菲尔德", "诺丁汉", "加的夫", "贝尔法斯特", "阿伯丁", "南安普敦"]
  },
  {
    country: "法国",
    capital: "巴黎",
    majorCities: ["马赛", "里昂"],
    tier1Cities: ["图卢兹", "尼斯", "南特", "斯特拉斯堡", "蒙彼利埃", "波尔多"],
    tier2Cities: ["里尔", "雷恩", "兰斯", "勒阿弗尔", "圣艾蒂安", "土伦"]
  },
  {
    country: "德国",
    capital: "柏林",
    majorCities: ["慕尼黑", "汉堡", "法兰克福"],
    tier1Cities: ["科隆", "斯图加特", "杜塞尔多夫", "多特蒙德", "埃森", "莱比锡"],
    tier2Cities: ["德累斯顿", "汉诺威", "纽伦堡", "杜伊斯堡", "波鸿", "乌珀塔尔"]
  },
  {
    country: "意大利",
    capital: "罗马",
    majorCities: ["米兰", "那不勒斯"],
    tier1Cities: ["都灵", "巴勒莫", "热那亚", "博洛尼亚", "佛罗伦萨", "威尼斯"],
    tier2Cities: ["巴里", "卡塔尼亚", "维罗纳", "梅西纳", "帕多瓦", "的里雅斯特"]
  },
  {
    country: "加拿大",
    capital: "渥太华",
    majorCities: ["多伦多", "蒙特利尔", "温哥华"],
    tier1Cities: ["卡尔加里", "埃德蒙顿", "温尼伯", "魁北克城"],
    tier2Cities: ["哈利法克斯", "汉密尔顿", "基奇纳", "伦敦", "维多利亚", "萨斯卡通"]
  },
  {
    country: "澳大利亚",
    capital: "堪培拉",
    majorCities: ["悉尼", "墨尔本"],
    tier1Cities: ["布里斯班", "珀斯", "阿德莱德", "黄金海岸"],
    tier2Cities: ["达尔文", "霍巴特", "凯恩斯", "汤斯维尔", "艾丽斯斯普林斯", "杰朗"]
  },
  {
    country: "俄罗斯",
    capital: "莫斯科",
    majorCities: ["圣彼得堡"],
    tier1Cities: ["新西伯利亚", "叶卡捷琳堡", "下诺夫哥罗德", "喀山", "车里雅宾斯克", "鄂木斯克"],
    tier2Cities: ["萨马拉", "顿河畔罗斯托夫", "乌法", "克拉斯诺亚尔斯克", "沃罗涅日", "彼尔姆"]
  },
  {
    country: "印度",
    capital: "新德里",
    majorCities: ["孟买", "班加罗尔", "加尔各答"],
    tier1Cities: ["钦奈", "海得拉巴", "艾哈迈达巴德", "浦那", "斋浦尔", "勒克瑙"],
    tier2Cities: ["坎普尔", "那格浦尔", "印多尔", "塔那", "博帕尔", "维沙卡帕特南"]
  },
  {
    country: "巴西",
    capital: "巴西利亚",
    majorCities: ["圣保罗", "里约热内卢"],
    tier1Cities: ["贝洛奥里藏特", "福塔雷萨", "萨尔瓦多", "库里提巴", "马瑙斯", "累西腓"],
    tier2Cities: ["维多利亚", "弗洛里亚诺波利斯", "戈亚尼亚", "坎皮纳斯", "圣路易斯", "马塞约"]
  },
  {
    country: "中国台湾",
    capital: "台北",
    majorCities: ["高雄"],
    tier1Cities: ["台中", "台南"],
    tier2Cities: ["花莲", "台东", "嘉义", "新竹", "基隆", "屏东", "宜兰", "苗栗", "彰化", "云林", "南投", "金门", "马公", "澎湖", "连江", "南竿"]
  },
  {
    country: "沙特阿拉伯",
    capital: "利雅得",
    majorCities: ["吉达", "麦加"],
    tier1Cities: ["达曼", "麦地那", "塔布克"],
    tier2Cities: ["阿卜哈", "海尔", "延布", "布赖代", "霍拉德", "哈米斯穆希特"]
  }
];

/**
 * 获取城市在该国家的重要性等级
 * @param cityName 城市名称
 * @param countryName 国家名称
 * @returns 重要性等级 (0=首都, 1=主要城市, 2=一线城市, 3=二线城市, 999=未分类)
 */
export function getCityPriority(cityName: string, countryName: string): number {
  const config = cityPriorityConfig.find(c => c.country === countryName);
  if (!config) return 999; // 未配置的国家

  // 首都最高优先级
  if (config.capital === cityName) return 0;

  // 主要城市
  if (config.majorCities.includes(cityName)) return 1;

  // 一线城市
  if (config.tier1Cities.includes(cityName)) return 2;

  // 二线城市
  if (config.tier2Cities.includes(cityName)) return 3;

  // 未分类城市
  return 999;
}

/**
 * 从机场中文名称提取城市名称
 */
export function extractCityName(airportChineseName: string): string {
  // 首先移除常见的机场后缀
  const suffixes = ['机场', '国际机场', '大兴国际机场', '首都国际机场', '浦东国际机场', '虹桥机场', '天河机场', '白云机场', '宝安机场', '双流机场', '萧山机场'];

  let cityName = airportChineseName;
  suffixes.forEach(suffix => {
    if (cityName.endsWith(suffix)) {
      cityName = cityName.substring(0, cityName.length - suffix.length);
    }
  });

  // 对于"城市+机场名"格式，提取城市部分
  // 例如: "台北桃园" -> "台北", "上海浦东" -> "上海"
  const cityPatterns = [
    /^([^0-9]+?)(桃园|松山|虹桥|浦东|首都|大兴|双流|萧山|天河|白云|宝安|流亭|高崎|龙嘉|太平|桃仙|地窝堡|中川|河东|曹家堡|贡嘎|白塔|吴圩|美兰|龙洞堡)$/,
    /^([^0-9]+?)(国际|机场)$/
  ];

  for (const pattern of cityPatterns) {
    const match = cityName.match(pattern);
    if (match) {
      cityName = match[1];
      break;
    }
  }

  // 处理特殊情况 (机场名称 -> 城市名称)
  const specialCases: { [key: string]: string } = {
    '北京大兴': '北京',
    '北京首都': '北京',
    '上海浦东': '上海',
    '上海虹桥': '上海',
    '广州白云': '广州',
    '深圳宝安': '深圳',
    '成都双流': '成都',
    '杭州萧山': '杭州',
    '武汉天河': '武汉',
    '西安咸阳': '西安',
    '重庆江北': '重庆',
    '昆明长水': '昆明',
    '大连周水子': '大连',
    '青岛流亭': '青岛',
    '厦门高崎': '厦门',
    '长沙黄花': '长沙',
    '南京禄口': '南京',
    '郑州新郑': '郑州',
    '济南遥墙': '济南',
    '福州长乐': '福州',
    '合肥新桥': '合肥',
    '南昌昌北': '南昌',
    '太原武宿': '太原',
    '石家庄正定': '石家庄',
    '哈尔滨太平': '哈尔滨',
    '长春龙嘉': '长春',
    '沈阳桃仙': '沈阳',
    '乌鲁木齐地窝堡': '乌鲁木齐',
    '兰州中川': '兰州',
    '银川河东': '银川',
    '西宁曹家堡': '西宁',
    '拉萨贡嘎': '拉萨',
    '呼和浩特白塔': '呼和浩特',
    '南宁吴圩': '南宁',
    '海口美兰': '海口',
    '贵阳龙洞堡': '贵阳',
    '纽约肯尼迪': '纽约',
    '纽约拉瓜迪亚': '纽约',
    '纽约纽瓦克': '纽约',
    '洛杉矶国际': '洛杉矶',
    '芝加哥奥黑尔': '芝加哥',
    '旧金山国际': '旧金山',
    '西雅图塔科马': '西雅图',
    '波士顿洛根': '波士顿',
    '迈阿密国际': '迈阿密',
    '拉斯维加斯麦卡伦': '拉斯维加斯',
    '丹佛国际': '丹佛',
    '亚特兰大哈茨菲尔德': '亚特兰大',
    '达拉斯沃思堡': '达拉斯',
    '休斯顿乔治布什': '休斯顿',
    '费城国际': '费城',
    '伦敦希思罗': '伦敦',
    '伦敦盖特威克': '伦敦',
    '伦敦斯坦斯特德': '伦敦',
    '巴黎戴高乐': '巴黎',
    '巴黎奥利': '巴黎',
    '法兰克福国际': '法兰克福',
    '慕尼黑国际': '慕尼黑',
    '阿姆斯特丹史基浦': '阿姆斯特丹',
    '马德里巴拉哈斯': '马德里',
    '罗马菲乌米奇诺': '罗马',
    '米兰马尔彭萨': '米兰',
    '东京成田': '东京',
    '东京羽田': '东京',
    '大阪关西': '大阪',
    '大阪伊丹': '大阪',
    '首尔仁川': '首尔',
    '首尔金浦': '首尔',
    '悉尼金斯福德史密斯': '悉尼',
    '墨尔本图拉马林': '墨尔本',
    '多伦多皮尔逊': '多伦多',
    '温哥华国际': '温哥华',
    '蒙特利尔特鲁多': '蒙特利尔',
    '台北桃园': '台北',
    '台北松山': '台北',
    '高雄小港': '高雄',
    '台中清泉岗': '台中',
    '台南归仁': '台南',
    '花莲吉安': '花莲',
    '台东丰年': '台东',
    '马祖南竿': '南竿',
    '澎湖马公': '马公',
    '金门尚义': '金门',
    // 印度机场名称映射
    '新德里英迪拉·甘地': '新德里',
    '孟买贾特拉帕蒂·希瓦吉': '孟买',
    '班加罗尔凯普伽奥达': '班加罗尔',
    '金奈': '钦奈',
    '海德拉巴拉吉夫·甘地': '海得拉巴',
    '加尔各答内塔吉·苏巴斯': '加尔各答',
    '果阿达博利姆': '果阿',
    '科钦': '科钦',
    '特里凡得琅': '特里凡得琅',
    '艾哈迈达巴德萨达尔': '艾哈迈达巴德',
    '浦那': '浦那',
    '斋浦尔': '斋浦尔',
    '勒克瑙': '勒克瑙',
    '那格浦尔': '那格浦尔'
  };

  return specialCases[cityName] || cityName;
}
