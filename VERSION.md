# 智能货运报价系统 - 版本更新日志

## V196 - 多crate格式解析与地址智能检测 (2025-06-10)

### 🎯 重大功能更新

#### 📦 多crate格式解析系统
- **完整crate格式支持** - 解析"crate 1: 300 sheets, 618kgs, 117X84x88cm"等详细格式
- **智能尺寸解析** - 自动提取每个crate的长宽高尺寸，支持X、×、*等分隔符
- **自动体积计算** - 根据尺寸自动计算每个crate体积并汇总
- **总计信息验证** - 解析"There are 3 crates/ 1808kgs/ 2.54m³ in total"等总计行
- **多crate汇总** - 自动计算总件数、总重量、总体积等关键指标

#### 🏠 地址智能检测与机场匹配
- **美国地址解析** - 智能识别"241 N Congress Ave, Delray Beach, FL 33445"等完整地址
- **机场自动匹配** - 根据城市和州自动推荐最近的国际机场
- **优先级算法** - 按城市重要度排序，优先推荐主要国际门户机场
- **实时地址检测** - 从货物文本中自动提取地址并设置起运地机场代码
- **多种地址格式** - 支持完整地址、简化地址、城市+州等多种格式

### 🛠️ 技术架构优化

#### 解析优先级系统
- **多crate最高优先级** - 确保复杂格式不被简单格式覆盖
- **智能冲突处理** - 防止不同解析器之间的数据冲突
- **解析流程优化** - 按复杂度和准确性排序的多层解析

#### 地址解析模块 (address-parser.ts)
- **结构化地址信息** - 分别提取街道、城市、州、邮编等组件
- **机场匹配算法** - 基于地理位置的智能机场推荐
- **城市-机场映射** - 预建的美国主要城市到国际机场映射表
- **州级备选机场** - 当精确匹配失败时的州级备选方案

### 📋 新增支持格式

#### 多crate格式类型
1. **完整格式** - "crate 1: 300 sheets, 618kgs, 117X84x88cm"
2. **简化格式** - "crate 1: 200 sheets, 500kgs, 100X80x60cm"
3. **总计验证** - "There are 3 crates/ 1808kgs/ 2.54m³ in total"
4. **地址集成** - 地址+crate信息的完整货运单据格式

#### 地址格式类型
1. **完整地址** - "241 N Congress Ave, Delray Beach, FL 33445"
2. **简化地址** - "Delray Beach, FL 33445"
3. **城市州格式** - "Miami, FL"
4. **多种街道类型** - Ave、Street、Blvd、Drive等各种街道后缀

### 🎨 用户界面增强

#### 新增示例按钮
- **多Crate格式示例** - 完整的crate货运单据示例
- **简化Crate示例** - 简化版本的crate格式
- **地址解析示例** - 地址+货物信息的综合示例

#### 智能提示优化
- **起运地自动填充** - 检测到地址后自动设置机场代码
- **实时解析反馈** - 显示解析到的地址和推荐机场
- **货物名称智能提取** - 从crate内容中提取货物类型（如"sheets"）

### 🧪 质量保证

#### 测试覆盖
- **正则表达式验证** - 多crate格式的完整正则匹配测试
- **地址解析测试** - 各种美国地址格式的解析准确性
- **机场匹配测试** - 城市到机场的智能匹配验证
- **端到端测试** - 完整的地址检测→机场匹配→货物解析流程

#### 数据准确性
- **crate数据验证** - 确保解析结果与原始数据一致
- **体积计算精度** - 尺寸到体积的准确转换（cm³→m³）
- **重量汇总准确** - 多个crate重量的正确累加
- **地址识别率** - 高准确率的美国地址格式识别

### 🚀 性能优化

#### 解析效率
- **优先级短路** - 高优先级格式匹配后立即返回，避免无效计算
- **正则优化** - 精确的正则表达式，减少误匹配
- **内存使用** - 高效的数据结构，减少解析过程中的内存占用

#### 用户体验
- **实时响应** - 输入变更后的即时解析反馈
- **智能预填充** - 减少用户手动输入的工作量
- **错误处理** - 优雅的异常处理和用户提示

---

## V95 - 数据识别完善与界面优化 (2025-06-07)

### 🎯 核心更新

#### 📊 数据识别系统重大优化
- **修复米(m)单位解析** - 正确识别和显示"尺寸：1.2*1.0*1.54m"格式
- **修复毫米(mm)单位计算** - 正确处理"尺寸mm"，体积计算除以10^9转换为立方米
- **完善三元组智能识别** - 支持重量/件数/体积的任意顺序组合
- **特殊格式支持** - "重量：23托 重量:9765 KGS"等复杂格式
- **独立体积标注** - "体积：42 CBM"等单独体积信息

#### 🎨 界面用户体验提升
- **示例按钮布局优化** - 7行整齐排列，37+种数据格式示例
- **带电货物警告** - 红色字体显示含电池货物
- **货物类型分类** - 超重货/重货/普货/轻货智能分类
- **计算结果优化** - 卡片式展示，颜色编码分类

### 🔧 技术架构改进

#### 核心解析引擎
- **智能单位识别** - 基于数值大小和明确标识自动判断单位
- **机场代码优化** - 全球500+机场代码支持，智能城市匹配
- **产品名称提取** - 多重正则表达式，智能过滤和提取

#### 计算系统精确化
- **体积重计算** - 按运输方式区分：海运1000、空运167、快递200
- **密度分析** - kg/cbm比重计算，货物类型智能判断
- **计费重优化** - 实重与体积重取大值的精确计算

### 📋 支持的数据格式（完整列表）

#### 基础格式
1. **传统格式** - "2500 kgs ; 14.71 cbm ; 6托"
2. **批量格式** - "148*113*80/1"
3. **单托格式** - "83*63*77CM, 135KG，一托"
4. **表格格式** - "HDL23938566-收货(KG)235"
5. **箱规格式** - "箱规：45*35*30cm，一件重是8.08kg 15箱"
6. **商品格式** - "Comm: 运动装备，数量：17箱"

#### 空运专业格式
7. **空运格式** - "DOH 3/908.3/5.66CBM"
8. **机场代码** - "LHR 2/456.7/3.2CBM"
9. **木箱格式** - "JFK 木箱：1750*1050*1600MM, 480KG"
10. **带电货物** - "LAX 音响设备 内置电池"

#### 三元组格式（6种顺序）
11. **件数/重量/体积** - "42件/751KG/2.57CBM"
12. **重量/件数/体积** - "751KG/42件/2.57CBM"
13. **体积/重量/件数** - "2.57CBM/751KG/42件"
14. **重量/体积/件数** - "751KG/2.57CBM/42件"
15. **件数/体积/重量** - "42件/2.57CBM/751KG"
16. **体积/件数/重量** - "2.57CBM/42件/751KG"

#### 国际标准格式
17. **CTNS格式** - "167 CTNS / 11.79 CBM / 634.60 KGS"
18. **CCU格式** - "CCU 1028/1.63/35*35*35CM*38CTNS"
19. **KHI格式** - "KHI//3400KG//12.33CBM//145CTNS"
20. **BEG格式** - "BEG 60ctn 618kg 2.41cbm"
21. **PEK格式** - "PEK---VCP 120×80×127 厘米 1.22方"

#### 重量术语格式
22. **GW格式** - "BOM 460CTN/GW3270KG/34CBM"
23. **NW格式** - "BOM 460CTN/NW2800KG/34CBM"
24. **CW格式** - "计费重753.6KG"

#### 特殊混合格式
25. **产品+机场** - "土耳其伊斯坦布尔 IST 根管锉之类的产品"
26. **单件规格** - "159件，单件尺寸：53*26*33cm/6.5kg"
27. **中文体积** - "16箱 135kg and 2.47方"
28. **托盘详细** - "5个托盘总体积是6个方，重量是1036KG"
29. **问号修复** - 企业微信复制产生的"?"字符自动清理

#### 高级智能格式
30. **重量顺序** - "120/3000KG/11.8CBM"
31. **米单位** - "尺寸：1.2*1.0*1.54m"
32. **毫米单位** - "尺寸1336*706*2005*2件 尺寸mm"
33. **FOB格式** - "FOB NINGBO"起运地识别
34. **多城市** - "深圳或者广州出"智能选择
35. **LED产品** - "710kg led发光手环（内置碱性干电池）"
36. **包装格式** - "Packing size: 1300*600*1150mm"
37. **特殊重量** - "重量：23托 重量:9765 KGS"

### 🛠️ 技术栈
- **前端框架**: Next.js 15 + TypeScript
- **UI组件**: Tailwind CSS + shadcn/ui
- **包管理器**: Bun
- **开发工具**: ESLint + Biome + Git

### 🚀 部署信息
- **开发服务器**: http://localhost:3000
- **GitHub仓库**: https://github.com/Darrenthinker/intelligent-freight-quote-system
- **版本标签**: v0.95.0

---

## V94 - 基础版本 (2025-06-06)
- 项目初始化和基础功能实现
- 核心解析引擎和计算系统
- 基础UI界面和组件结构
